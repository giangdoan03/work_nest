<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>PDF.js v5 Viewer</title>
    <style>
        html, body { margin: 0; height: 100%; background: #f0f0f0; }
        #viewerContainer { position: fixed; inset: 0; overflow: auto; background: #f0f0f0; }
        .pdfViewer .page { margin: 8px auto; border: 1px solid #ccc; background: #fff; }
    </style>
</head>
<body>
<div id="viewerContainer"><div id="viewer" class="pdfViewer"></div></div>

<script type="module">
    import * as pdfjsLib from '/pdfjs/build/pdf.mjs';
    import { PDFViewer, EventBus, PDFLinkService } from '/pdfjs/build/pdf_viewer.mjs';

    // Worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = '/pdfjs/build/pdf.worker.mjs';

    // Lấy ?file=...
    const params = new URLSearchParams(location.search);
    const fileUrl = params.get('file');
    if (!fileUrl) {
        document.body.innerHTML = '<p style="text-align:center;margin-top:20px;color:#888;">No file specified (?file=...)</p>';
        throw new Error('No file provided');
    }

    // Container và viewer
    const container = document.getElementById('viewerContainer');
    const eventBus = new EventBus();
    const linkService = new PDFLinkService({ eventBus });
    const pdfViewer = new PDFViewer({
        container,
        eventBus,
        linkService,
        textLayerMode: 0,
        annotationMode: 2
    });
    linkService.setViewer(pdfViewer);

    // Load file PDF
    const loadingTask = pdfjsLib.getDocument({
        url: fileUrl,
        cMapUrl: '/pdfjs/cmaps/',
        cMapPacked: true
    });
    const pdf = await loadingTask.promise;
    pdfViewer.setDocument(pdf);
    linkService.setDocument(pdf);

    // Fit theo chiều ngang
    eventBus.on('pagesinit', () => {
        pdfViewer.currentScaleValue = 'page-width';
    });
</script>
</body>
</html>
